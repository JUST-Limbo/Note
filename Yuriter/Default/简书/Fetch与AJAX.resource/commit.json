{"compress":true,"commitItems":[["6f07e9e4-2dfd-4989-93f1-51575dbfa01a",1577239738194,"",[[1577239709132,["Administrator@WIN-T3FPCJLTUH1",[[1,0,"# Fetch与XMLHttpRequest\n\n\n\n"]],[0,0],[25,25]]],[1577239716743,["Administrator@WIN-T3FPCJLTUH1",[[-1,25,"\n"]],[25,25],[24,24]]],[1577239719032,["Administrator@WIN-T3FPCJLTUH1",[[-1,24,"\n"]],[24,24],[23,23]]],[1577239751779,["Administrator@WIN-T3FPCJLTUH1",[[1,23,"fetch是一种HTTP数据请求的方式，是XMLHttpRequest的一种替代方案。fetch不是ajax的进一步封装，而是原生js。Fetch函数就是原生js，没有使用XMLHttpRequest对象。\n\n作者：anna_0707\n链接：https://www.jianshu.com/p/7762515f8d1a\n来源：简书\n著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。"]],[23,23],[223,223]]],[1577239760960,["Administrator@WIN-T3FPCJLTUH1",[[-1,128,"作者：anna_0707\n链接：https://www.jianshu.com/p/7762515f8d1a\n来源：简书\n著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。"]],[128,223],[128,128]]],[1577239761497,["Administrator@WIN-T3FPCJLTUH1",[[-1,128,"\n"]],[128,128],[127,127]]],[1577239765208,["Administrator@WIN-T3FPCJLTUH1",[[1,23,"\n"]],[22,22],[23,23]]],[1577239775361,["Administrator@WIN-T3FPCJLTUH1",[[1,129,"\n"]],[128,128],[129,129]]],[1577239778856,["Administrator@WIN-T3FPCJLTUH1",[[1,129,"  "]],[129,129],[131,131]]],[1577239780979,["Administrator@WIN-T3FPCJLTUH1",[[-1,129,"  "]],[131,131],[129,129]]],[1577239783598,["Administrator@WIN-T3FPCJLTUH1",[[-1,129,"\n"],[1,130,"#"]],[129,129],[130,130]]],[1577239789080,["Administrator@WIN-T3FPCJLTUH1",[[1,130,"# akax"]],[130,130],[136,136]]],[1577239789874,["Administrator@WIN-T3FPCJLTUH1",[[-1,133,"kax"]],[136,136],[133,133]]],[1577239790297,["Administrator@WIN-T3FPCJLTUH1",[[1,133,"k"]],[133,133],[134,134]]],[1577239790625,["Administrator@WIN-T3FPCJLTUH1",[[-1,133,"k"]],[134,134],[133,133]]],[1577239791235,["Administrator@WIN-T3FPCJLTUH1",[[1,133,"jax"]],[133,133],[136,136]]],[1577239793876,["Administrator@WIN-T3FPCJLTUH1",[[1,136,"\n\n"]],[136,136],[137,137]]],[1577239799625,["Administrator@WIN-T3FPCJLTUH1",[[1,138,"\n"]],[137,137],[138,138]]],[1577239813709,["Administrator@WIN-T3FPCJLTUH1",[[1,138,"* 使用步骤"]],[138,138],[144,144]]],[1577239818675,["Administrator@WIN-T3FPCJLTUH1",[[1,145,"* \n"]],[144,144],[147,147]]],[1577239821755,["Administrator@WIN-T3FPCJLTUH1",[[-1,145,"* "]],[147,147],[146,146]]],[1577239828537,["Administrator@WIN-T3FPCJLTUH1",[[1,145,"1. "]],[146,146],[149,149]]],[1577239833168,["Administrator@WIN-T3FPCJLTUH1",[[-1,148,"\n"]],[149,149],[148,148]]],[1577239833816,["Administrator@WIN-T3FPCJLTUH1",[[-1,146,". "]],[148,148],[146,146]]],[1577239834164,["Administrator@WIN-T3FPCJLTUH1",[[-1,145,"1"],[1,146,"\n"]],[146,146],[145,145]]],[1577239834779,["Administrator@WIN-T3FPCJLTUH1",[[-1,145,"\n"]],[145,145],[144,144]]],[1577239835181,["Administrator@WIN-T3FPCJLTUH1",[[1,145,"* \n"]],[144,144],[147,147]]],[1577239839168,["Administrator@WIN-T3FPCJLTUH1",[[-1,145,"* "]],[147,147],[145,145]]],[1577239856796,["Administrator@WIN-T3FPCJLTUH1",[[1,145,"    1. 创建XML"]],[145,145],[157,157]]],[1577239865671,["Administrator@WIN-T3FPCJLTUH1",[[1,157,"HttpRequest对象"]],[157,157],[170,170]]],[1577239866537,["Administrator@WIN-T3FPCJLTUH1",[[1,171,"    2. \n"]],[170,170],[178,178]]],[1577239877807,["Administrator@WIN-T3FPCJLTUH1",[[1,178,"调用open方法设置基本请求信息"]],[178,178],[194,194]]],[1577239878354,["Administrator@WIN-T3FPCJLTUH1",[[1,195,"    3. \n"]],[194,194],[202,202]]],[1577239889807,["Administrator@WIN-T3FPCJLTUH1",[[1,202,"设置发送的数据，发送请求"]],[202,202],[214,214]]],[1577239890309,["Administrator@WIN-T3FPCJLTUH1",[[1,215,"    4. \n"]],[214,214],[222,222]]],[1577239897680,["Administrator@WIN-T3FPCJLTUH1",[[1,222,"注册监听的回调函数"]],[222,222],[231,231]]],[1577239898031,["Administrator@WIN-T3FPCJLTUH1",[[1,232,"    5. \n"]],[231,231],[239,239]]],[1577239904492,["Administrator@WIN-T3FPCJLTUH1",[[1,239,"拿到返回值，随页面"]],[239,239],[248,248]]],[1577239905576,["Administrator@WIN-T3FPCJLTUH1",[[-1,245,"随页面"]],[248,248],[245,245]]],[1577239913842,["Administrator@WIN-T3FPCJLTUH1",[[1,245,"对页面进行更新"]],[245,245],[252,252]]],[1577239915741,["Administrator@WIN-T3FPCJLTUH1",[[1,253,"    6. \n"]],[252,252],[260,260]]],[1577239916331,["Administrator@WIN-T3FPCJLTUH1",[[-1,259," "]],[260,260],[259,259]]],[1577239919617,["Administrator@WIN-T3FPCJLTUH1",[[-1,253,"    6."]],[259,259],[253,253]]],[1577239921512,["Administrator@WIN-T3FPCJLTUH1",[[-1,253,"\n"],[1,254,"*"]],[253,253],[254,254]]],[1577239921810,["Administrator@WIN-T3FPCJLTUH1",[[1,254," "]],[254,254],[255,255]]],[1577239926705,["Administrator@WIN-T3FPCJLTUH1",[[-1,148," "]],[149,149],[148,148]]],[1577239928920,["Administrator@WIN-T3FPCJLTUH1",[[-1,173," "]],[174,174],[173,173]]],[1577239929434,["Administrator@WIN-T3FPCJLTUH1",[[-1,196," "]],[197,197],[196,196]]],[1577239930098,["Administrator@WIN-T3FPCJLTUH1",[[-1,215," "]],[216,216],[215,215]]],[1577239930693,["Administrator@WIN-T3FPCJLTUH1",[[-1,231," "]],[232,232],[231,231]]],[1577239932475,["Administrator@WIN-T3FPCJLTUH1",[[-1,147," "]],[148,148],[147,147]]],[1577239933324,["Administrator@WIN-T3FPCJLTUH1",[[-1,171," "]],[172,172],[171,171]]],[1577239934458,["Administrator@WIN-T3FPCJLTUH1",[[-1,193," "]],[194,194],[193,193]]],[1577239935097,["Administrator@WIN-T3FPCJLTUH1",[[-1,211," "]],[212,212],[211,211]]],[1577239935798,["Administrator@WIN-T3FPCJLTUH1",[[-1,226," "]],[227,227],[226,226]]],[1577239937167,["Administrator@WIN-T3FPCJLTUH1",[[-1,146," "]],[147,147],[146,146]]],[1577239946273,["Administrator@WIN-T3FPCJLTUH1",[[1,146,"     "]],[146,146],[147,147]]],[1577239947810,["Administrator@WIN-T3FPCJLTUH1",[[-1,150," "]],[147,147],[146,146]]],[1577239951156,["Administrator@WIN-T3FPCJLTUH1",[[-1,145,"     "]],[145,150],[145,145]]],[1577239951720,["Administrator@WIN-T3FPCJLTUH1",[[1,145,"  "]],[145,145],[147,147]]],[1577239960658,["Administrator@WIN-T3FPCJLTUH1",[[1,245,"···"]],[245,245],[248,248]]],[1577239961940,["Administrator@WIN-T3FPCJLTUH1",[[-1,245,"···"]],[248,248],[245,245]]],[1577239965757,["Administrator@WIN-T3FPCJLTUH1",[[1,245,"``````"]],[245,245],[251,251]]],[1577239967359,["Administrator@WIN-T3FPCJLTUH1",[[1,248,"\n"]],[248,248],[249,249]]],[1577239970443,["Administrator@WIN-T3FPCJLTUH1",[[-1,250,"``"]],[252,252],[250,250]]],[1577239970588,["Administrator@WIN-T3FPCJLTUH1",[[-1,249,"`"],[1,250,"\n"]],[250,250],[249,249]]],[1577239970765,["Administrator@WIN-T3FPCJLTUH1",[[-1,249,"\n"]],[249,249],[248,248]]],[1577239971460,["Administrator@WIN-T3FPCJLTUH1",[[-1,245,"```"]],[248,248],[245,245]]],[1577239973670,["Administrator@WIN-T3FPCJLTUH1",[[-1,243,"* "]],[245,245],[244,244]]],[1577239976933,["Administrator@WIN-T3FPCJLTUH1",[[-1,243,"\n"],[1,244,"*"]],[244,244],[244,244]]],[1577239977667,["Administrator@WIN-T3FPCJLTUH1",[[1,244,"\n\n"]],[244,244],[245,245]]],[1577240481146,["Administrator@WIN-T3FPCJLTUH1",[[1,244," "]],[244,244],[245,245]]],[1577240518504,["Administrator@WIN-T3FPCJLTUH1",[[1,247,"```javascript\n//1.创建Ajax对象\nif (window.XMLHttpRequest) {\n    var oAjax = new XMLHttpRequest();\n} else {\n    var oAjax = new ActiveXObject(\"Microsoft.XMLHTTP\");\n}\n\n//2.连接服务器（打开和服务器的连接）\noAjax.open('GET', url, true);\n\n//3.发送\noAjax.send();\n\n//4.接收\noAjax.onreadystatechange = function() {\n    if (oAjax.readyState == 4) {\n        if (oAjax.status == 200) {\n            //alert('成功了：'+oAjax.responseText);\n            fnSucc(oAjax.responseText);\n        } else {\n            //alert('失败了');\n            if (fnFaild) {\n                fnFaild();\n            }\n        }\n    }\n};\n```\n\n"]],[245,245],[823,823]]],[1577240521752,["Administrator@WIN-T3FPCJLTUH1",[[-1,246,"\n"]],[246,246],[245,245]]],[1577240531342,["Administrator@WIN-T3FPCJLTUH1",[[1,243,"  6. \n"]],[242,242],[248,248]]],[1577240534935,["Administrator@WIN-T3FPCJLTUH1",[[-1,243,"  6. "]],[248,248],[243,243]]],[1577240543636,["Administrator@WIN-T3FPCJLTUH1",[[-1,245," "]],[246,246],[245,245]]],[1577240553170,["Administrator@WIN-T3FPCJLTUH1",[[1,245," "]],[245,245],[246,246]]],[1577240572589,["Administrator@WIN-T3FPCJLTUH1",[[-1,244,"* "]],[246,246],[245,245]]],[1577240575905,["Administrator@WIN-T3FPCJLTUH1",[[-1,244,"\n"]],[244,244],[243,243]]],[1577243474854,["Administrator@WIN-T3FPCJLTUH1",[[1,820,"\n"]],[819,819],[820,820]]],[1577243476148,["Administrator@WIN-T3FPCJLTUH1",[[-1,820,"\n"],[1,821,"#"]],[820,820],[821,821]]],[1577243479289,["Administrator@WIN-T3FPCJLTUH1",[[1,821,"# fetch"]],[821,821],[828,828]]],[1577243479701,["Administrator@WIN-T3FPCJLTUH1",[[1,828,"\n\n"]],[828,828],[829,829]]],[1577243481186,["Administrator@WIN-T3FPCJLTUH1",[[1,830,"\n"]],[829,829],[830,830]]],[1577243485351,["Administrator@WIN-T3FPCJLTUH1",[[-1,830,"\n"],[1,831,"*"]],[830,830],[831,831]]],[1577243487088,["Administrator@WIN-T3FPCJLTUH1",[[1,831," tedia"]],[831,831],[837,837]]],[1577243488778,["Administrator@WIN-T3FPCJLTUH1",[[-1,832,"tedia"]],[837,837],[832,832]]],[1577243500849,["Administrator@WIN-T3FPCJLTUH1",[[1,832,"特点\n* "]],[832,832],[837,837]]],[1577243501543,["Administrator@WIN-T3FPCJLTUH1",[[1,835,"  "]],[837,837],[839,839]]],[1577243505339,["Administrator@WIN-T3FPCJLTUH1",[[-1,836," * "]],[839,839],[836,836]]],[1577243505742,["Administrator@WIN-T3FPCJLTUH1",[[-1,835," "],[1,836,"\n"]],[836,836],[835,835]]],[1577243508310,["Administrator@WIN-T3FPCJLTUH1",[[-1,835,"\n"],[1,836,"1"]],[835,835],[836,836]]],[1577243508798,["Administrator@WIN-T3FPCJLTUH1",[[1,836,". "]],[836,836],[838,838]]],[1577243511632,["Administrator@WIN-T3FPCJLTUH1",[[1,835,"  "]],[838,838],[840,840]]],[1577243544389,["Administrator@WIN-T3FPCJLTUH1",[[1,840,"第一个参数是URL\n  2. 第二个是可选参数，可以控制不同配置的init对象\n  3. 使用来了"]],[840,840],[889,889]]],[1577243545811,["Administrator@WIN-T3FPCJLTUH1",[[-1,887,"来了"]],[889,889],[887,887]]],[1577243571707,["Administrator@WIN-T3FPCJLTUH1",[[1,887,"了JS Promises来处理结果/回调\n  4. "]],[887,887],[913,913]]],[1577243573511,["Administrator@WIN-T3FPCJLTUH1",[[-1,908,"  4. "],[1,913,"\n\n"]],[913,913],[909,909]]],[1577243574980,["Administrator@WIN-T3FPCJLTUH1",[[-1,909,"\n"],[1,910,"*"]],[909,909],[910,910]]],[1577243575313,["Administrator@WIN-T3FPCJLTUH1",[[1,910," "]],[910,910],[911,911]]],[1577243592132,["Administrator@WIN-T3FPCJLTUH1",[[1,911,"\n\n```javascript\nfetch(url).then(response => response.json())\n    .then(data => console.log(data))\n    .catch(e => console.log(\"Oops, error\", e))\n```\n\n\n"]],[911,911],[1061,1061]]],[1577243594501,["Administrator@WIN-T3FPCJLTUH1",[[-1,912,"\n"]],[912,912],[911,911]]],[1577243595840,["Administrator@WIN-T3FPCJLTUH1",[[-1,909,"* "]],[911,911],[909,909]]],[1577243596143,["Administrator@WIN-T3FPCJLTUH1",[[-1,909,"\n"]],[909,909],[908,908]]],[1577243603101,["Administrator@WIN-T3FPCJLTUH1",[[-1,1057,"\n"],[1,1058,"*"]],[1057,1057],[1058,1058]]],[1577243605154,["Administrator@WIN-T3FPCJLTUH1",[[1,1058," geng"]],[1058,1058],[1063,1063]]],[1577243606040,["Administrator@WIN-T3FPCJLTUH1",[[-1,1059,"geng"]],[1063,1063],[1059,1059]]],[1577243611811,["Administrator@WIN-T3FPCJLTUH1",[[1,1059,"更酷一点\n* "]],[1059,1059],[1066,1066]]],[1577243613275,["Administrator@WIN-T3FPCJLTUH1",[[-1,1064,"* "],[1,1066,"\n\n"]],[1066,1066],[1065,1065]]],[1577243628853,["Administrator@WIN-T3FPCJLTUH1",[[1,1064,"  你可以通过Request构造器函数创建一个新的请求对象，你还可以基于原有的对象创建一个新的对象。 新的请求和旧的并没有什么不同，但你可以通过稍微调整配置对象，将其用于不同的场景。例如："]],[1064,1064],[1158,1158]]],[1577243634055,["Administrator@WIN-T3FPCJLTUH1",[[-1,1064,"  "]],[1066,1066],[1064,1064]]],[1577243641530,["Administrator@WIN-T3FPCJLTUH1",[[1,1064,"* \n"]],[1063,1063],[1066,1066]]],[1577243643357,["Administrator@WIN-T3FPCJLTUH1",[[-1,1064,"* "]],[1066,1066],[1064,1064]]],[1577243646876,["Administrator@WIN-T3FPCJLTUH1",[[-1,1064,"\n"]],[1064,1064],[1063,1063]]],[1577243667371,["Administrator@WIN-T3FPCJLTUH1",[[1,1064,"    "]],[1064,1064],[1068,1068]]],[1577243669118,["Administrator@WIN-T3FPCJLTUH1",[[-1,1067," "]],[1068,1068],[1067,1067]]],[1577243669768,["Administrator@WIN-T3FPCJLTUH1",[[1,1067," "]],[1067,1067],[1068,1068]]],[1577243670996,["Administrator@WIN-T3FPCJLTUH1",[[-1,1064,"    "]],[1068,1068],[1064,1064]]],[1577243671908,["Administrator@WIN-T3FPCJLTUH1",[[1,1064,"    "]],[1064,1064],[1068,1068]]],[1577243673744,["Administrator@WIN-T3FPCJLTUH1",[[-1,1064,"    "]],[1068,1068],[1064,1064]]],[1577243674078,["Administrator@WIN-T3FPCJLTUH1",[[1,1064,"  "]],[1064,1064],[1066,1066]]],[1577243692109,["Administrator@WIN-T3FPCJLTUH1",[[1,1160,"```javascript\nvar req = new Request(URL, {\n    method: 'GET',\n    cache: 'reload'\n});\nfetch(req).then(function(response) {\n    return response.json();\n}).then(function(json) {\n    insertPhotos(json);\n});\n```\n\n"]],[1158,1158],[1369,1369]]],[1577243699573,["Administrator@WIN-T3FPCJLTUH1",[[1,1369,"\n"]],[1369,1369],[1370,1370]]],[1577243702515,["Administrator@WIN-T3FPCJLTUH1",[[-1,1369,"\n"],[1,1370,"#"]],[1370,1370],[1370,1370]]],[1577243707929,["Administrator@WIN-T3FPCJLTUH1",[[1,1370,"# fetch和"]],[1370,1370],[1378,1378]]],[1577243723420,["Administrator@WIN-T3FPCJLTUH1",[[-1,8,"XMLHttpRequest"],[1,22,"A"]],[8,22],[9,9]]],[1577243726291,["Administrator@WIN-T3FPCJLTUH1",[[1,9,"JAXX"]],[9,9],[13,13]]],[1577243765472,["Administrator@WIN-T3FPCJLTUH1",[[1,1369,"AJAX的主要区别"]],[1369,1369],[1378,1378]]],[1577243765948,["Administrator@WIN-T3FPCJLTUH1",[[1,1378,"\n\n"]],[1378,1378],[1379,1379]]],[1577243768028,["Administrator@WIN-T3FPCJLTUH1",[[-1,1379,"\n"],[1,1380,"1"]],[1379,1379],[1380,1380]]],[1577243782012,["Administrator@WIN-T3FPCJLTUH1",[[1,1380,". fetch()返回的promise将不会拒绝http的错误状态，即使响应是一个HTTP 404或者500\n2. 在默认情况下 fetch不会接受或者发送cookies\n3. "]],[1380,1380],[1469,1469]]],[1577243782429,["Administrator@WIN-T3FPCJLTUH1",[[-1,1466,"3. "],[1,1469,"\n\n"]],[1469,1469],[1467,1467]]],[1577243784757,["Administrator@WIN-T3FPCJLTUH1",[[-1,1467,"\n"],[1,1468,"#"]],[1467,1467],[1468,1468]]],[1577243793024,["Administrator@WIN-T3FPCJLTUH1",[[1,1468,"# fetch的"]],[1468,1468],[1476,1476]]],[1577243800387,["Administrator@WIN-T3FPCJLTUH1",[[-1,1470,"fetch的"]],[1476,1476],[1470,1470]]],[1577243806738,["Administrator@WIN-T3FPCJLTUH1",[[1,1470,"fetch封装"]],[1470,1470],[1477,1477]]],[1577243807469,["Administrator@WIN-T3FPCJLTUH1",[[1,1477,"\n\n"]],[1477,1477],[1478,1478]]],[1577243817204,["Administrator@WIN-T3FPCJLTUH1",[[1,1479,"```javascript\nexport default async (url = '', data = {}, type = 'GET', method = 'fetch') => {\n    type = type.toUpperCase();\n    url = baseUrl + url;\n\n    if (type == 'GET') {\n        let dataStr = ''; //数据拼接字符串\n        Object.keys(data).forEach(key => {\n            dataStr += key + '=' + data[key] + '&';\n        })\n\n        if (dataStr !== '') {\n            dataStr = dataStr.substr(0, dataStr.lastIndexOf('&'));\n            url = url + '?' + dataStr;\n        }\n    }\n\n    if (window.fetch && method == 'fetch') {\n        let requestConfig = {\n            credentials: 'include', //为了在当前域名内自动发送 cookie ， 必须提供这个选项\n            method: type,\n            headers: {\n                'Accept': 'application/json',\n                'Content-Type': 'application/json'\n            },\n            mode: \"cors\", //请求的模式\n            cache: \"force-cache\"\n        }\n\n        if (type == 'POST') {\n            Object.defineProperty(requestConfig, 'body', {\n                value: JSON.stringify(data)\n            })\n        }\n\n        try {\n            const response = await fetch(url, requestConfig);\n            const responseJson = await response.json();\n            return responseJson\n        } catch (error) {\n            throw new Error(error)\n        }\n    } else {\n        return new Promise((resolve, reject) => {\n            let requestObj;\n            if (window.XMLHttpRequest) {\n                requestObj = new XMLHttpRequest();\n            } else {\n                requestObj = new ActiveXObject;\n            }\n\n            let sendData = '';\n            if (type == 'POST') {\n                sendData = JSON.stringify(data);\n            }\n\n            requestObj.open(type, url, true);\n            requestObj.setRequestHeader(\"Content-type\", \"application/x-www-form-urlencoded\");\n            requestObj.send(sendData);\n\n            requestObj.onreadystatechange = () => {\n                if (requestObj.readyState == 4) {\n                    if (requestObj.status == 200) {\n                        let obj = requestObj.response\n                        if (typeof obj !== 'object') {\n                            obj = JSON.parse(obj);\n                        }\n                        resolve(obj)\n                    } else {\n                        reject(requestObj)\n                    }\n                }\n            }\n        })\n    }\n}\n```\n\n\n"]],[1478,1478],[3831,3831]]],[1577243828752,["Administrator@WIN-T3FPCJLTUH1",[[-1,3831,"\n"]],[3831,3831],[3830,3830]]],[1577243833853,["Administrator@WIN-T3FPCJLTUH1",[[1,1379,"\n"]],[1378,1378],[1379,1379]]],[1577243849899,["Administrator@WIN-T3FPCJLTUH1",[[-1,123,"ajax"],[1,127,"A"]],[123,127],[124,124]]],[1577243850553,["Administrator@WIN-T3FPCJLTUH1",[[1,124,"JAX"]],[124,124],[127,127]]],[1577244122637,["Administrator@WIN-T3FPCJLTUH1",[[-1,12,"X"]],[13,13],[12,12]]]],null,"Administrator@WIN-T3FPCJLTUH1"]]}